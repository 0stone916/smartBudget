# 📌 SmartBudget – 개인 예산 관리 웹 서비스
> **데이터 정합성 보장 및 배치 운영 안정성을 강화한 백엔드 설계**

## 🛠 Tech Stack
- **Back-end**: Java 17, Spring Boot, Spring Batch 5, Redis, MySQL, MyBatis
- **Front-end**: React

## 🚀 핵심 기술적 해결 과제 (Engineering Challenge)
**400만 건 규모의 데이터 조회 성능 최적화**
* **문제 상황**: 인덱스 부재로 인한 전체 스캔(`Full Scan`) 발생, 조회 시 약 23초 응답 지연 및 서버 부하 발생.
* **해결 전략**:
    * **인덱스 전략**: 쿼리 분석을 통해 `(user_id, year, month)` 복합 인덱스를 설계하여 검색 범위를 물리적으로 제한.
    * **DB 옵티마이저 제어**: `EXPLAIN` 분석 및 통계 정보(`ANALYZE`) 갱신을 통해 최적의 실행 계획을 유도하여 검색 속도를 **16ms**로 단축.
    * **표준화**: OFFSET 페이징 기법을 도입하여 대용량 데이터 전송에 따른 네트워크 병목을 선제적으로 해소.

## ⚙️ 운영 고도화 및 장애 대응 (Spring Batch 5)
단순 자동화를 넘어 **운영 가시성**과 **장애 복구**를 고려한 아키텍처를 설계했습니다.

* **배치 결과 요약 및 감사(Audit) 체계**:
    * `StepExecution`을 활용하여 배치 단위별 성공/스킵/실패 건수를 집계하는 **요약 테이블** 도입.
    * 단순 디버그 로그가 아닌 운영 감사용 로그(Audit Log)를 분리 적용하여 장애 인지 및 원인 분석 시간 단축.
* **장애 허용(Fault Tolerance) 및 재처리(Reprocess) 설계**:
    * **실패 이력 관리**: `Write` 단계 예외 발생 시 전용 테이블에 실패 사유 및 카테고리 저장.
    * **재처리 전용 배치 구성**: 실패 이력을 Reader로 사용하는 별도의 Job을 설계하여 실패 건만 재처리할 수 있도록 구현.
    * **비즈니스 vs 장애 스킵 분리**: 지출 없음, 이미 생성된 예산 등은 비즈니스 스킵으로, 예외 발생은 장애 스킵으로 구분하여 정밀한 운영 통계 확보.
* **멱등성(Idempotency) 확보**: 재실행 시 데이터 중복 방지를 위해 애플리케이션(exists 체크)과 DB(Composite Unique Key) 수준의 이중 방어 설계.

## 🧪 테스트 및 안정성 검증
- **동시성 실증 테스트**: 멀티스레드 환경에서 N개 이상의 수정 요청 시 **1건만 성공하고 나머지는 예외 발생**함을 `assertThat`으로 검증
- **중복 등록 차단 검증**: 동일 조건의 예산 등록 시 `DuplicateKeyException` 발생 및 에러 핸들링 여부 테스트
- **배치 프로세스 테스트**: 운영 환경과 동일한 구조의 테스트용 DB를 구성하여 배치 재실행·재처리 시나리오를 검증

## 💰 데이터 정합성 (Concurrency Control)
- **Optimistic Lock**: `@Version` 컬럼을 활용한 낙관적 락 적용으로 다중 탭/기기의 동시 수정 충돌 방지
- **복합 유니크 제약**: `사용자ID + 년 + 월 + 카테고리` 조합의 Unique Key 설정을 통해 물리적 데이터 무결성 확보
- **공통 응답 표준화**: `ApiResponse` 규격화 및 `GlobalExceptionHandler`를 통한 중앙 집중식 예외 처리 (409 Conflict 등)

## 🔐 인증 및 보안 (Security)
- **Double Token 구조**: Access Token(단기) 및 Refresh Token(장기)을 활용한 보안 강화
- **Redis 기반 단일 세션 관리**: Redis에 `userId`를 Key로 토큰을 저장하여, **재로그인 시 기존 세션을 즉시 Overwrite(무효화)** 하는 서버 주도 세션 제어 구현
- **자동 재발급 로직**: Axios 인터셉터를 통해 토큰 만료 시 사용자 개입 없이 자동 재발급 (다중 요청 시 Refresh 요청은 1회만 수행되도록 설계)
- **로그아웃 실효성**: 로그아웃 시 Redis 내 토큰 데이터를 즉시 삭제하여 Stateless 환경에서도 실시간 세션 차단 기능 확보
  
## 📝 코드 품질 및 설계 표준화
- **중앙 집중식 예외 처리 (@RestControllerAdvice)**
    - **관심사 분리**: 비즈니스 로직과 예외 처리 로직을 완전히 분리하여 코드 가독성 및 유지보수 효율성 증대 [cite: 104, 105, 172]
    - **커스텀 예외(BusinessException) 설계**: 토큰 만료, 유효성 실패 등 세분화된 예외 상황을 체계적으로 관리하기 위해 자바 표준 상속 구조를 활용한 사용자 정의 예외 계층 구축 
    - **전역 응답 표준화**: `ErrorCode Enum`을 기반으로 프레임워크 예외와 커스텀 예외의 응답 규격을 `ApiResponse`로 단일화하여 프론트엔드 협업 생산성 극대화


## 📘 상세 설계 문서 (Portfolio)
👉 [SmartBudget 노션 상세 페이지](https://www.notion.so/2cc2c24577cc80638969fa8cf6d240d5)
