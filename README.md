# 📌 SmartBudget – 개인 예산 관리 웹 서비스
> **400만 건 대용량 트랜잭션 환경에서 데이터 정합성과 응답 성능을 보장하는 백엔드 설계**

개인별 예산 수립 및 지출 내역을 관리하는 서비스로, 단순 기능 구현을 넘어 **대규모 데이터 조회 성능 최적화**와 **배치 운영 안정성** 확보에 집중하여 개발했습니다.

## 🛠 Tech Stack
- **Back-end**: Java 17, Spring Boot, Spring Batch 5, Redis, MySQL, MyBatis
- **Front-end**: React

## 🚀 핵심 기술적 해결 과제 (Engineering Challenge)

### 400만 건 규모의 대용량 지출 내역 조회 성능 최적화

* **[Problem] 시스템 물리적 한계 및 병목 발생**
    * 테이블 조인(`JOIN`)과 정렬(`ORDER BY`)이 결합되어 `Using filesort` 및 임시 테이블 발생.
    * 조회 요청 시 **평균 23초의 응답 지연** 발생으로 실시간 서비스 불가능 확인.

* **[Solution] 실행 계획 분석 기반의 인덱스 및 쿼리 튜닝**
    * **복합 인덱스 전략 수립**: `(user_id, year, month, day DESC, id DESC)` 순의 복합 인덱스를 설계하여 검색 효율을 극대화하고 `Filesort` 오버헤드를 물리적으로 제거.
    * **No-Offset 커서 페이징 도입**: 마지막 조회 식별자(`day`, `id`)를 활용한 커서 기반 페이징으로 전환하여 데이터 규모와 무관한 **O(1) 수준의 탐색 성능** 확보.
    * **인라인 뷰(Subquery) 최적화**: 조인 전 정렬 및 페이징을 선행 처리하도록 쿼리 구조를 개선하여, 불필요한 전체 데이터 조인 비용 제거.
    * **성능 개선 결과**: `EXPLAIN` 분석을 통한 실행 계획 최적화로 **응답 시간을 23s에서 22ms로 단축 (약 1,000배 개선)**.

* **[Learning]**
    * 데이터베이스 옵티마이저의 동작 원리와 인덱스 트리 구조를 깊이 이해함으로써, 단순 기능 구현을 넘어 **예측 가능한 성능을 설계하는 백엔드 엔지니어**의 중요성을 체감함.

## ⚙️ 운영 고도화 및 장애 대응 (Spring Batch 5)
단순 자동화를 넘어 **운영 가시성**과 **장애 복구**를 고려한 아키텍처를 설계했습니다.

* **배치 결과 요약 및 감사(Audit) 체계**:
    * `StepExecution`을 활용하여 배치 단위별 성공/스킵/실패 건수를 집계하는 **요약 테이블** 도입.
    * 단순 디버그 로그가 아닌 운영 감사용 로그(Audit Log)를 분리 적용하여 장애 인지 및 원인 분석 시간 단축.
* **장애 허용(Fault Tolerance) 및 재처리(Reprocess) 설계**:
    * **실패 이력 관리**: `Write` 단계 예외 발생 시 전용 테이블에 실패 사유 및 카테고리 저장.
    * **재처리 전용 배치 구성**: 실패 이력을 Reader로 사용하는 별도의 Job을 설계하여 실패 건만 재처리할 수 있도록 구현.
    * **비즈니스 vs 장애 스킵 분리**: 지출 없음, 이미 생성된 예산 등은 비즈니스 스킵으로, 예외 발생은 장애 스킵으로 구분하여 정밀한 운영 통계 확보.
* **멱등성(Idempotency) 확보**: 재실행 시 데이터 중복 방지를 위해 애플리케이션(exists 체크)과 DB(Composite Unique Key) 수준의 이중 방어 설계.

### 💰 데이터 정합성 및 무결성 설계 (Concurrency Control)

* **Optimistic Lock 활용**: `@Version` 컬럼을 통한 낙관적 락을 적용하여, 수정 빈도가 낮은 예산 설정 로직에서 DB 부하를 최소화하면서도 다중 기기의 동시 수정 충돌을 원천 방지
* **복합 유니크 제약(Unique Key) 전략**: `(user_id, year, month, category_code)` 조합의 물리적 제약 조건을 설정하여 애플리케이션 계층뿐만 아니라 DB 레벨에서도 중복 데이터 생성을 차단, 무결성을 확보

## 🔐 인증 및 보안 (Security)
- **Double Token 구조**: Access Token(단기) 및 Refresh Token(장기)을 활용한 보안 강화
- **Redis 기반 단일 세션 관리**: Redis에 `userId`를 Key로 토큰을 저장하여, **재로그인 시 기존 세션을 즉시 Overwrite(무효화)** 하는 서버 주도 세션 제어 구현
- **자동 재발급 로직**: Axios 인터셉터를 통해 토큰 만료 시 사용자 개입 없이 자동 재발급 (다중 요청 시 Refresh 요청은 1회만 수행되도록 설계)
- **로그아웃 실효성**: 로그아웃 시 Redis 내 토큰 데이터를 즉시 삭제하여 Stateless 환경에서도 실시간 세션 차단 기능 확보

## 🧪 테스트 및 안정성 검증
- **동시성 실증 테스트**: 멀티스레드 환경에서 N개 이상의 수정 요청 시 **1건만 성공하고 나머지는 예외 발생**함을 `assertThat`으로 검증
- **중복 등록 차단 검증**: 동일 조건의 예산 등록 시 `DuplicateKeyException` 발생 및 에러 핸들링 여부 테스트
- **배치 프로세스 테스트**: 운영 환경과 동일한 구조의 테스트용 DB를 구성하여 배치 재실행·재처리 시나리오를 검증
  
## 📝 코드 품질 및 설계 표준화
- **중앙 집중식 예외 처리 (@RestControllerAdvice)**
    - **관심사 분리**: 비즈니스 로직과 예외 처리 로직을 완전히 분리하여 코드 가독성 및 유지보수 효율성 증대 [cite: 104, 105, 172]
    - **커스텀 예외(BusinessException) 설계**: 토큰 만료, 유효성 실패 등 세분화된 예외 상황을 체계적으로 관리하기 위해 자바 표준 상속 구조를 활용한 사용자 정의 예외 계층 구축 
    - **전역 응답 표준화**: `ErrorCode Enum`을 기반으로 프레임워크 예외와 커스텀 예외의 응답 규격을 `ApiResponse`로 단일화하여 프론트엔드 협업 생산성 극대화


## 📘 상세 설계 문서 (Portfolio)
👉 [SmartBudget 노션 상세 페이지](https://www.notion.so/2cc2c24577cc80638969fa8cf6d240d5)
